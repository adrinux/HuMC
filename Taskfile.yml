version: '2'

#include: Taskvars.yml

tasks:

# Setup web-mc
  setup:
    cmds:
      - echo 'Starting'
      - hugo-installed
      - node-setup


  # Install node_modules
  node-setup:
    deps:
      - node_installed
    desc: Run npm install if node_modules doesn't exist
    cmds:
      - npm install
    status:
      - test -d node_modules

  # Check if node installed
  node_installed:
    silent: true
    cmds:
      - |
        if ! command -v node > /dev/null; then
          echo "node is not installed. aborting."
          exit 1
        fi
      - echo "node installed, ok."

  hugo-installed:
    silent: true
    cmds:
      - |
        if ! command -v hugo > /dev/null; then
          echo "hugo is not installed. aborting."
          exit 1
        fi
      - echo "hugo installed, ok."


# Sites
# Copy existing test-site to new name
# how to pass in name? config file? Taskvars.yml can list global variables
# seems like the place for site config

# could also have sites/sitename/Taskvars.yml

  sites:
    cmds:
      - echo {{ .SITE_NAME }}
